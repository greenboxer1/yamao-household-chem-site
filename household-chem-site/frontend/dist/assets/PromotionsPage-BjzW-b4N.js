import{r as t,j as e,d as y,J as j,P as L,a as P,L as w,F as E,U as C,k as N}from"./index-D7BkVHUS.js";const A=()=>{const[n,i]=t.useState([]),[c,h]=t.useState(!0),[u,d]=t.useState(""),s=t.useRef(null),[a,g]=t.useState(!1),[S,b]=t.useState(!1),[v,x]=t.useState(!1);t.useEffect(()=>{(async()=>{h(!0);try{const r=await P.get("/products?limit=50"),o=r.data.products||r.data;if(!Array.isArray(o)){console.error("Fetched products is not an array:",o),d("Не удалось загрузить список товаров: неверный формат данных."),i([]);return}const f=o.filter(p=>p.discountPrice&&parseFloat(p.discountPrice)>0&&parseFloat(p.discountPrice)<parseFloat(p.price));i(f),d("")}catch(r){console.error("Ошибка при загрузке товаров со скидкой:",r),d("Не удалось загрузить товары со скидкой."),i([])}finally{h(!1)}})()},[]);const m=t.useCallback(()=>{if(s.current){const{scrollWidth:l,clientWidth:r,scrollLeft:o}=s.current,f=l>r+1;g(f),f?(b(o>.5),x(o<l-r-.5)):(b(!1),x(!1))}else g(!1),b(!1),x(!1)},[g,b,x]);t.useLayoutEffect(()=>{c||m()},[n,c,m]),t.useEffect(()=>{const l=()=>{m()};let r=null;return!c&&s.current&&(window.addEventListener("resize",l),r=s.current,r.addEventListener("scroll",m)),()=>{window.removeEventListener("resize",l),r&&r.removeEventListener("scroll",m)}},[c,m]);const U=l=>{if(s.current){const r=s.current.clientWidth*.9;let o=s.current.scrollLeft+(l==="left"?-r:r);const f=s.current.scrollWidth-s.current.clientWidth;o=Math.max(0,Math.min(o,f)),s.current.scrollTo({left:o,behavior:"smooth"})}};return c&&n.length===0?e.jsx("div",{className:"text-center p-5",children:e.jsx(y,{icon:"spinner",spin:!0,size:"3x"})}):u?e.jsx(j,{note:!0,noteColor:"danger",className:"mt-3 mb-3 text-center",children:u}):n.length===0&&!c?e.jsx(j,{note:!0,noteColor:"info",className:"mt-3 mb-3 text-center",children:"В данный момент нет товаров со скидкой."}):e.jsxs("div",{className:"discounted-products-container my-4",children:[e.jsx("h3",{className:"mb-4 text-center",children:"Товары со скидкой"}),e.jsxs("div",{className:"horizontal-scroll-wrapper",children:[a&&S&&e.jsx("button",{onClick:()=>U("left"),className:"scroll-arrow left-arrow",children:e.jsx(y,{fas:!0,icon:"chevron-left"})}),e.jsx("div",{className:"products-list-horizontal",ref:s,children:n.map(l=>e.jsx("div",{className:"product-card-wrapper",children:e.jsx(L,{product:l})},l.id))}),a&&v&&e.jsx("button",{onClick:()=>U("right"),className:"scroll-arrow right-arrow",children:e.jsx(y,{fas:!0,icon:"chevron-right"})})]})]})},R=()=>{const[n,i]=t.useState({banner1Url:null,banner2Url:null}),[c,h]=t.useState(!0),[u,d]=t.useState("");return t.useEffect(()=>{(async()=>{h(!0);try{const a=await P.get("/promotional-banners");a.data&&typeof a.data=="object"?i({banner1Url:a.data.banner1Url||null,banner2Url:a.data.banner2Url||null}):(i({banner1Url:null,banner2Url:null}),console.warn("Данные о баннерах не в ожидаемом формате или отсутствуют:",a.data)),d("")}catch(a){console.error("Ошибка загрузки промо-баннеров:",a),d("Не удалось загрузить промо-баннеры."),i({banner1Url:null,banner2Url:null})}finally{h(!1)}})()},[]),e.jsxs(w,{fluid:!0,className:"promotions-page-container py-4",children:[c&&e.jsx("div",{className:"text-center my-5",children:e.jsx(E,{role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Загрузка..."})})}),u&&e.jsx(j,{note:!0,noteColor:"danger",className:"mt-3 mb-3 text-center",children:u}),!c&&!u&&e.jsxs(C,{className:"mb-4 promo-banners-row",children:[n.banner1Url&&e.jsx(N,{md:n.banner2Url?"6":"12",className:"mb-3 mb-md-0 promo-banner-col",children:e.jsx("img",{src:n.banner1Url,alt:"Promotional Banner 1",className:"img-fluid promo-banner-image"})}),n.banner2Url&&e.jsx(N,{md:n.banner1Url?"6":"12",className:"promo-banner-col",children:e.jsx("img",{src:n.banner2Url,alt:"Promotional Banner 2",className:"img-fluid promo-banner-image"})}),!n.banner1Url&&!n.banner2Url&&e.jsx(N,{md:"12",className:"text-center",children:e.jsx(j,{note:!0,noteColor:"info",children:"Актуальные промо-баннеры скоро появятся!"})})]}),e.jsx(A,{})]})};export{R as default};
