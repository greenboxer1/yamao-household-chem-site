import{r as n,j as e,d as j,J as p,P as z,a as N,L as F,F as W,U as X,k as L}from"./index-Dv7vmZBp.js";const I=()=>{const[l,i]=n.useState([]),[c,h]=n.useState(!0),[d,f]=n.useState(""),r=n.useRef(null),[o,S]=n.useState(!1),[w,b]=n.useState(!1),[E,x]=n.useState(!1),[y,U]=n.useState(!1),[C,M]=n.useState(0),[A,R]=n.useState(0),k=1.5;n.useEffect(()=>{(async()=>{h(!0);try{const s=await N.get("/products?limit=50"),a=s.data.products||s.data;if(!Array.isArray(a)){console.error("Fetched products is not an array:",a),f("Не удалось загрузить список товаров: неверный формат данных."),i([]);return}const m=a.filter(g=>g.discountPrice&&parseFloat(g.discountPrice)>0&&parseFloat(g.discountPrice)<parseFloat(g.price));i(m),f("")}catch(s){console.error("Ошибка при загрузке товаров со скидкой:",s),f("Не удалось загрузить товары со скидкой."),i([])}finally{h(!1)}})()},[]);const u=n.useCallback(()=>{if(r.current){const{scrollWidth:t,clientWidth:s,scrollLeft:a}=r.current,m=t>s+1;S(m),m?(b(a>.5),x(a<t-s-.5)):(b(!1),x(!1))}else S(!1),b(!1),x(!1)},[S,b,x]);n.useLayoutEffect(()=>{c||u()},[l,c,u]),n.useEffect(()=>{const t=()=>{u()};let s=null;return!c&&r.current&&(window.addEventListener("resize",t),s=r.current,s.addEventListener("scroll",u)),()=>{window.removeEventListener("resize",t),s&&s.removeEventListener("scroll",u)}},[c,u]);const B=t=>{!r.current||t.target.closest("button, a")||t.clientX>=r.current.clientWidth+r.current.offsetLeft-17&&t.offsetY>=r.current.clientHeight-17||(U(!0),M(t.pageX-r.current.offsetLeft),R(r.current.scrollLeft),r.current.classList.add("dragging-scroll"),document.body.style.userSelect="none")},v=()=>{y&&(U(!1),r.current&&r.current.classList.remove("dragging-scroll"),document.body.style.userSelect="")},D=t=>{if(!y||!r.current)return;t.preventDefault();const a=(t.pageX-r.current.offsetLeft-C)*k;r.current.scrollLeft=A-a,u()},P=t=>{if(r.current){const s=r.current.clientWidth*.9;let a=r.current.scrollLeft+(t==="left"?-s:s);const m=r.current.scrollWidth-r.current.clientWidth;a=Math.max(0,Math.min(a,m)),r.current.scrollTo({left:a,behavior:"smooth"})}};return c&&l.length===0?e.jsx("div",{className:"text-center p-5",children:e.jsx(j,{icon:"spinner",spin:!0,size:"3x"})}):d?e.jsx(p,{note:!0,noteColor:"danger",className:"mt-3 mb-3 text-center",children:d}):l.length===0&&!c?e.jsx(p,{note:!0,noteColor:"info",className:"mt-3 mb-3 text-center",children:"В данный момент нет товаров со скидкой."}):e.jsxs("div",{className:"discounted-products-container my-4",children:[e.jsx("h3",{className:"mb-4 text-center",children:"Товары со скидкой"}),e.jsxs("div",{className:"horizontal-scroll-wrapper",children:[o&&w&&e.jsx("button",{onClick:()=>P("left"),className:"scroll-arrow left-arrow",children:e.jsx(j,{fas:!0,icon:"chevron-left"})}),e.jsx("div",{className:"products-list-horizontal",ref:r,onMouseDown:B,onMouseLeave:v,onMouseUp:v,onMouseMove:D,children:l.map(t=>e.jsx("div",{className:"product-card-wrapper",children:e.jsx(z,{product:t})},t.id))}),o&&E&&e.jsx("button",{onClick:()=>P("right"),className:"scroll-arrow right-arrow",children:e.jsx(j,{fas:!0,icon:"chevron-right"})})]})]})},T=()=>{const[l,i]=n.useState({banner1Url:null,banner2Url:null}),[c,h]=n.useState(!0),[d,f]=n.useState("");return n.useEffect(()=>{(async()=>{h(!0);try{const o=await N.get("/promotional-banners");o.data&&typeof o.data=="object"?i({banner1Url:o.data.banner1Url||null,banner2Url:o.data.banner2Url||null}):(i({banner1Url:null,banner2Url:null}),console.warn("Данные о баннерах не в ожидаемом формате или отсутствуют:",o.data)),f("")}catch(o){console.error("Ошибка загрузки промо-баннеров:",o),f("Не удалось загрузить промо-баннеры."),i({banner1Url:null,banner2Url:null})}finally{h(!1)}})()},[]),e.jsxs(F,{fluid:!0,className:"promotions-page-container py-4",children:[c&&e.jsx("div",{className:"text-center my-5",children:e.jsx(W,{role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Загрузка..."})})}),d&&e.jsx(p,{note:!0,noteColor:"danger",className:"mt-3 mb-3 text-center",children:d}),!c&&!d&&e.jsxs(X,{className:"mb-4 promo-banners-row",children:[l.banner1Url&&e.jsx(L,{md:l.banner2Url?"6":"12",className:"mb-3 mb-md-0 promo-banner-col",children:e.jsx("img",{src:l.banner1Url,alt:"Promotional Banner 1",className:"img-fluid promo-banner-image rounded-3"})}),l.banner2Url&&e.jsx(L,{md:l.banner1Url?"6":"12",className:"promo-banner-col",children:e.jsx("img",{src:l.banner2Url,alt:"Promotional Banner 2",className:"img-fluid promo-banner-image rounded-3"})}),!l.banner1Url&&!l.banner2Url&&e.jsx(L,{md:"12",className:"text-center",children:e.jsx(p,{note:!0,noteColor:"info",children:"Актуальные промо-баннеры скоро появятся!"})})]}),e.jsx(I,{})]})};export{T as default};
